---
slug: webpack
title: webpack打包原理
---

### 是什么

    webpack是一个现代js应用程序的*静态模块打包器* （module bundler）当webpack处理应用程序时，会
    递归地构建一个*依赖关系树*，其中包含应用程序需要地每个模块，然后将所有这些模块打包成一个或者多个bundle.

### 怎么做

    webpack就像一条生产线，要经过一系列处理流程后才能将源文件源文件转换成输出结果，
    这条生产线上的每个处理流程的职责都是单一的，多个流程之间
    存在依赖关系，只有当前完成当前的处理后才能交给下一个流程去处理。插件就像是一个插入到生成线中的一个功能，
    在特定的时机对生产线上的资源做处理。
    webpack通过*Tapable*来组织这条复杂的生产线，webpack在运行过程中会广播事件，插件只需要监听它所关心的事件
    就能加入到这条生产线中去改变生产线的运作。

### 构建流程

Webpack 的运行流程是一个串行的过程,从启动到结束会依次执行以下流程 :

1、初始化参数：从配置文件和 Shell 语句中读取与合并参数,得出最终的参数。

2、开始编译：用上一步得到的参数初始化 Compiler 对象,加载所有配置的插件,执行对象的 run 方法开始执行编译。

3、确定入口：根据配置中的 entry 找出所有的入口文件。

4、编译模块：从入口文件出发,调用所有配置的 Loader 对模块进行翻译,再找出该模块依赖的模块,再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理。

5、完成模块编译：在经过第 4 步使用 Loader 翻译完所有模块后,得到了每个模块被翻译后的最终内容以及它们之间的依赖关系。

6、输出资源：根据入口和模块之间的依赖关系,组装成一个个包含多个模块的 Chunk,再把每个 Chunk 转换成一个单独的文件加入到输出列表,这步是可以修改输出内容的最后机会。

7、输出完成：在确定好输出内容后,根据配置确定输出的路径和文件名,把文件内容写入到文件系统。

在以上过程中,Webpack 会在特定的时间点广播出特定的事件,插件在监听到感兴趣的事件后会执行特定的逻辑,并且插件可以调用 Webpack 提供的 API 改变 Webpack 的运行结果。

